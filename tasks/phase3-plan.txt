│ Plan to implement                                                                                   │
│                                                                                                     │
│ Plan: Phase 3 — UI Layer (src/ui/)                                                                  │
│                                                                                                     │
│ Context                                                                                             │
│                                                                                                     │
│ Phase 2 (Core Library) and Phase 2b (Core Library Tests) are complete with 63 passing tests. Phase  │
│ 3 builds the terminal UI layer — raw ANSI escape codes, no external libraries. Clean and            │
│ professional like Claude Code, with Midnight-branded animations.                                    │
│                                                                                                     │
│ All output follows the convention: stdout for data (pipeable), stderr for                           │
│ animations/spinners/status.                                                                         │
│                                                                                                     │
│ Files to Create (in order)                                                                          │
│                                                                                                     │
│ 1. src/ui/colors.ts — Foundation                                                                    │
│                                                                                                     │
│ Color palette using ANSI 256 codes from DESIGN.md:                                                  │
│ - Midnight blue (17), teal (38), purple (99), white, dim gray, red, green, yellow                   │
│ - Helper functions: fg(text, code), bg(text, code), bold(), dim()                                   │
│ - Named shortcuts: teal(), purple(), red(), green(), yellow()                                       │
│ - isColorEnabled() — checks NO_COLOR env var                                                        │
│ - All color functions return plain text when colors disabled                                        │
│                                                                                                     │
│ 2. src/ui/format.ts — Text Formatting                                                               │
│                                                                                                     │
│ Uses colors.ts. All functions return strings (callers decide where to write).                       │
│ - header(title) — ═-bordered centered title                                                         │
│ - divider() — ─ repeated line                                                                       │
│ - keyValue(key, value) — left-aligned key with padding + value                                      │
│ - formatNight(microNight) — always 6 decimal places, appends "NIGHT"                                │
│ - formatAddress(address, truncate?) — teal-colored, optional truncation                             │
│ - box(lines, style) — light (┌─┐│└─┘) or heavy (╔═╗║╚═╝) box drawing                                │
│ - errorBox(error, suggestion?) — red-bordered box with recovery guidance                            │
│ - successMessage(msg, txHash?) — green ✓ prefix                                                     │
│                                                                                                     │
│ 3. src/ui/spinner.ts — Braille Spinner                                                              │
│                                                                                                     │
│ Writes to stderr via \r in-place updates.                                                           │
│ - Braille frames: ⠋ ⠙ ⠹ ⠸ ⠼ ⠴ ⠦ ⠧ ⠇ ⠏                                                               │
│ - start(message), update(message), stop(finalMessage?)                                              │
│ - ~80ms interval                                                                                    │
│ - withSpinner(message, asyncFn) — convenience wrapper with cleanup on error                         │
│ - Degrades to static "⠋ message" + "\r✓ done" when NO_COLOR                                         │
│                                                                                                     │
│ 4. src/ui/art.ts — Logo & Frames                                                                    │
│                                                                                                     │
│ Static data module, no animation timing.                                                            │
│ - MIDNIGHT_LOGO — the block-character logo string                                                   │
│ - WORDMARK — 'm i d n i g h t'                                                                      │
│ - getMaterializeFrame(progress) — takes 0.0–1.0, returns logo with noise proportional to 1 -        │
│ progress. At 0.0: all random block chars. At 1.0: the clean logo. Generated algorithmically         │
│ (replace logo chars with random ░▒▓ based on progress threshold per character).                     │
│ - getWordmarkFrame(progress) — takes 0.0–1.0, returns partial wordmark typed out                    │
│                                                                                                     │
│ 5. src/ui/animate.ts — Operation Animations                                                         │
│                                                                                                     │
│ Orchestrates frame-based animations on stderr. Each animation is a standalone async function (not a │
│  class — simpler, composable):                                                                      │
│ - animateMaterialize() — logo noise→resolved + wordmark type-out                                    │
│ - animateSync(onProgress) — starfield dots with progress counter                                    │
│ - animateProving(onProgress) — hex stream resolving to PROVED ✓                                     │
│ - animateTransfer(onProgress) — byte flow trail ████░░░░████                                        │
│ - animateDust(onProgress) — dots accumulating                                                       │
│ - animateSuccess(message) — brief burst then clean message                                          │
│ - animateError() — red flash on current line                                                        │
│ - animateIdle(abortSignal) — twinkling dots until cancelled                                         │
│                                                                                                     │
│ All animations:                                                                                     │
│ - Accept an AbortSignal or return a stop handle for cancellation                                    │
│ - Write to stderr with \r (no stdout pollution)                                                     │
│ - Degrade to static text when NO_COLOR is set                                                       │
│ - ~80-100ms frame intervals                                                                         │
│                                                                                                     │
│ Phase 3b: Tests                                                                                     │
│                                                                                                     │
│ src/__tests__/colors.test.ts                                                                        │
│                                                                                                     │
│ - Color wrapping produces correct ANSI sequences                                                    │
│ - isColorEnabled() returns false when NO_COLOR is set                                               │
│ - All helpers return plain text when colors disabled                                                │
│ - No color bleed (reset code always appended)                                                       │
│                                                                                                     │
│ src/__tests__/format.test.ts                                                                        │
│                                                                                                     │
│ - formatNight() — decimal precision for whole numbers, fractions, zero, large values                │
│ - formatAddress() — full vs truncated output, teal coloring                                         │
│ - keyValue() — alignment padding                                                                    │
│ - box() — correct box-drawing characters, multi-line content                                        │
│ - header() / divider() — correct border characters                                                  │
│                                                                                                     │
│ Verification                                                                                        │
│                                                                                                     │
│ - npm run typecheck passes                                                                          │
│ - npm test — all existing tests still pass + new UI tests pass                                      │
│ - Manual: import and call formatNight(1_500_000n) → "1.500000 NIGHT"                                │
│ - Manual: spinner visible on stderr, doesn't corrupt stdout                                         │
│                                                                                                     │
│ Implementation Order                                                                                │
│                                                                                                     │
│ 1. colors.ts                                                                                        │
│ 2. format.ts + format.test.ts                                                                       │
│ 3. spinner.ts                                                                                       │
│ 4. art.ts                                                                                           │
│ 5. animate.ts                                                                                       │
│ 6. colors.test.ts                                                                                   │
│ 7. Typecheck + full test run                                                                        │
╰────────────────────────────────────────────